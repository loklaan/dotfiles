{{- if ne "" .emailWork -}}
#!/usr/bin/env bash
set -euo pipefail

IFS=$'\n\t'

# Source shared logging library and setup session logging
source "${HOME}/.local/lib/bash-logging.sh"
setup_session_logging "$(basename "$0")"

#/ Usage:
#/   canva-misc.sh
#/
#/ Description:
#/   Installs Canva-specific quirks. Some actions are scoped to dev boxes
#/   via the DEVBOX_EMAIL environment variable.
#/
#/ Environment Variables:
#/   DEVBOX_EMAIL:            Available in Canva dev boxes; if set to your work email, enables dev box quirks.
#/
#/ Options:
#/   --help:      Display this help message
usage() { grep '^#/' "$0" | cut -c4-; }

parse_args() {
  while [ "$#" -gt 0 ]; do
    case "$1" in
      --help)
        usage
        exit 0
        ;;
      *)
        usage
        fatal "Unknown argument: $1"
        ;;
    esac
  done

  config_in_canva_devbox="false"
  if [ "{{ .emailWork }}" != "" ] && [ "${DEVBOX_EMAIL:-}" = "{{ .emailWork }}" ]; then
    config_in_canva_devbox="true"
  fi
}

main() {
  parse_args "$@"

  # 1. Update Claude Code
  info "╍ Updating Claude Code"
  otter claude-code update >/dev/null 2>&1

  if [ "$config_in_canva_devbox" = "true" ]; then
    info "▶ Starting installation of canva dev box quirks!"

    # 2. Ensure mise for the canva monorepo is installed in the devbox-specific directory structure.
    cd ~/work/canva && mise trust --quiet .mise.local.toml && ln -s ../../dev/canva/canva/.mise.local.toml .  >/dev/null 2>&1 || true

    # 3. ...

    info "▶ Done installing canva dev box quirks. Ensured mise is set up for the pre-cloned canva monorepo."
  else
    info "▶ Done installing canva dev box quirks. No action required (not in a canva dev box)."
  fi
}

main "$@"
{{ end -}}
